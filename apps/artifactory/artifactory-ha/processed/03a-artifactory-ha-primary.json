{"kind": "List", "apiVersion": "v1", "metadata": {}, "items": [{"apiVersion": "apps/v1", "kind": "StatefulSet", "metadata": {"labels": {"app": "artifactory", "component": "artifactory-ha", "role": "artifactory-primary"}, "name": "artifactory-primary"}, "spec": {"selector": {"matchLabels": {"app": "artifactory", "component": "artifactory-ha", "role": "artifactory-primary"}}, "serviceName": "artifactory-primary", "template": {"metadata": {"labels": {"app": "artifactory", "component": "artifactory-ha", "role": "artifactory-primary"}}, "spec": {"containers": [{"command": ["/bin/sh", "-c", "mkdir -p /var/opt/jfrog/artifactory/access/etc; cp -Lrf /tmp/access/bootstrap.creds /var/opt/jfrog/artifactory/access/etc/bootstrap.creds; chmod 600 /var/opt/jfrog/artifactory/access/etc/bootstrap.creds; /entrypoint-artifactory.sh\n"], "env": [{"name": "DB_TYPE", "value": "postgresql"}, {"name": "DB_HOST", "value": "postgresql-master"}, {"name": "DB_PORT", "value": "5432"}, {"name": "DB_USER", "value": "artifactory"}, {"name": "DB_PASSWORD", "valueFrom": {"secretKeyRef": {"key": "app-db-password", "name": "postgresql"}}}, {"name": "EXTRA_JAVA_OPTIONS", "value": "-Xms1g -Xmx2g"}, {"name": "ARTIFACTORY_MASTER_KEY", "valueFrom": {"secretKeyRef": {"key": "master-key", "name": "artifactory"}}}, {"name": "HA_IS_PRIMARY", "value": "true"}, {"name": "HA_MEMBERSHIP_PORT", "value": "10017"}, {"name": "HA_NODE_ID", "valueFrom": {"fieldRef": {"apiVersion": "v1", "fieldPath": "metadata.name"}}}, {"name": "HA_DATA_DIR", "value": "/var/opt/jfrog/artifactory-ha"}, {"name": "HA_BACKUP_DIR", "value": "/var/opt/jfrog/artifactory-backup"}], "image": "docker.bintray.io/jfrog/artifactory-pro:7.4.1", "imagePullPolicy": "IfNotPresent", "livenessProbe": {"failureThreshold": 10, "httpGet": {"path": "/artifactory/webapp/#/login", "port": 8040, "scheme": "HTTP"}, "initialDelaySeconds": 180, "periodSeconds": 10, "successThreshold": 1, "timeoutSeconds": 10}, "name": "artifactory", "ports": [{"containerPort": 8081, "protocol": "TCP"}], "readinessProbe": {"failureThreshold": 10, "httpGet": {"path": "/artifactory/webapp/#/login", "port": 8040, "scheme": "HTTP"}, "initialDelaySeconds": 60, "periodSeconds": 10, "successThreshold": 1, "timeoutSeconds": 10}, "resources": {"limits": {"cpu": "1", "memory": "3Gi"}, "requests": {"cpu": "500m", "memory": "2Gi"}}, "securityContext": {"allowPrivilegeEscalation": false}, "terminationMessagePath": "/dev/termination-log", "terminationMessagePolicy": "File", "volumeMounts": [{"mountPath": "/var/opt/jfrog/artifactory", "name": "volume"}, {"mountPath": "/var/opt/jfrog/artifactory-ha", "name": "artifactory-ha-data"}, {"mountPath": "/var/opt/jfrog/artifactory-backup", "name": "artifactory-ha-backup"}, {"mountPath": "/artifactory_extra_conf/binarystore.xml", "name": "binarystore-xml", "subPath": "binarystore.xml"}, {"mountPath": "/tmp/access/bootstrap.creds", "name": "access-bootstrap-creds", "subPath": "bootstrap.creds"}, {"mountPath": "/artifactory_extra_conf/info/installer-info.json", "name": "installer-info", "subPath": "installer-info.json"}]}], "dnsPolicy": "ClusterFirst", "initContainers": [{"command": ["sh", "-c", "if [ -d /var/opt/jfrog/artifactory/lost+found ]; then\n  rm -rfv /var/opt/jfrog/artifactory/lost+found\nfi\n"], "image": "alpine:3.8", "imagePullPolicy": "IfNotPresent", "name": "remove-lost-found", "resources": {}, "terminationMessagePath": "/dev/termination-log", "terminationMessagePolicy": "File", "volumeMounts": [{"mountPath": "/var/opt/jfrog/artifactory", "name": "volume"}]}, {"command": ["sh", "-c", "until nc -z -w 2 postgresql-master 5432 && echo database ok; do\n  sleep 2;\ndone;\n"], "image": "alpine:3.8", "imagePullPolicy": "IfNotPresent", "name": "wait-for-db", "resources": {}, "terminationMessagePath": "/dev/termination-log", "terminationMessagePolicy": "File"}], "restartPolicy": "Always", "schedulerName": "default-scheduler", "securityContext": {}, "serviceAccount": "artifactory", "serviceAccountName": "artifactory", "terminationGracePeriodSeconds": 30, "volumes": [{"configMap": {"defaultMode": 420, "name": "artifactory-bs"}, "name": "binarystore-xml"}, {"configMap": {"defaultMode": 420, "name": "artifactory-installer-info"}, "name": "installer-info"}, {"name": "access-bootstrap-creds", "secret": {"defaultMode": 420, "secretName": "artifactory-bootstrap-creds"}}, {"name": "artifactory-ha-data", "persistentVolumeClaim": {"claimName": "artifactory-artifactory-ha-data-pvc-0"}}, {"name": "artifactory-ha-backup", "persistentVolumeClaim": {"claimName": "artifactory-artifactory-ha-backup-pvc"}}]}}, "updateStrategy": {"type": "RollingUpdate"}, "volumeClaimTemplates": [{"metadata": {"name": "volume"}, "spec": {"accessModes": ["ReadWriteOnce"], "resources": {"requests": {"storage": "5Gi"}}}}]}}]}