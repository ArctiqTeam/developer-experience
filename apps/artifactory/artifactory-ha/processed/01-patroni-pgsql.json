{"kind": "List", "apiVersion": "v1", "metadata": {}, "items": [{"apiVersion": "v1", "kind": "Service", "metadata": {"creationTimestamp": null, "labels": {"app": "postgresql", "app.kubernetes.io/component": "database", "app.kubernetes.io/instance": "postgresql", "app.kubernetes.io/managed-by": "template", "app.kubernetes.io/name": "patroni", "app.kubernetes.io/version": "10", "cluster-name": "postgresql", "phase": "deploy"}, "name": "postgresql-master"}, "spec": {"ports": [{"port": 5432, "protocol": "TCP", "targetPort": 5432}], "selector": {"app.kubernetes.io/name": "patroni", "cluster-name": "postgresql", "role": "master"}, "sessionAffinity": "None", "type": "ClusterIP"}, "status": {"loadBalancer": {}}}, {"apiVersion": "v1", "kind": "ConfigMap", "metadata": {"annotations": {"config": "{\n  \"synchronous_mode\":\"yes\",\n  \"synchronous_mode_strict\":false,\n  \"postgresql\":{\n    \"parameters\":{\n      \"max_prepared_transactions\":0,\n      \"max_connections\":100,\n      \"max_locks_per_transaction\":64\n    },\n    \"use_pg_rewind\":true,\n    \"use_slots\":true\n  },\n  \"synchronous_standby_names\":\"*\"\n}\n"}, "labels": {"app": "postgresql", "app.kubernetes.io/component": "database", "app.kubernetes.io/instance": "postgresql", "app.kubernetes.io/managed-by": "template", "app.kubernetes.io/name": "patroni", "app.kubernetes.io/version": "10", "cluster-name": "postgresql", "phase": "deploy"}, "name": "postgresql-config"}}, {"apiVersion": "apps/v1", "kind": "StatefulSet", "metadata": {"creationTimestamp": null, "generation": 3, "labels": {"app": "postgresql", "app.kubernetes.io/component": "database", "app.kubernetes.io/instance": "postgresql", "app.kubernetes.io/managed-by": "template", "app.kubernetes.io/name": "patroni", "app.kubernetes.io/version": "10", "cluster-name": "postgresql", "phase": "deploy"}, "name": "postgresql"}, "spec": {"podManagementPolicy": "OrderedReady", "replicas": 2, "revisionHistoryLimit": 10, "selector": {"matchLabels": {"statefulset": "postgresql"}}, "serviceName": "postgresql", "template": {"metadata": {"creationTimestamp": null, "labels": {"app.kubernetes.io/name": "patroni", "cluster-name": "postgresql", "statefulset": "postgresql"}}, "spec": {"affinity": {"podAntiAffinity": {"requiredDuringSchedulingIgnoredDuringExecution": [{"labelSelector": {"matchExpressions": [{"key": "statefulset", "operator": "In", "values": ["postgresql"]}]}, "topologyKey": "kubernetes.io/hostname"}]}}, "containers": [{"env": [{"name": "POD_IP", "valueFrom": {"fieldRef": {"apiVersion": "v1", "fieldPath": "status.podIP"}}}, {"name": "PATRONI_KUBERNETES_NAMESPACE", "valueFrom": {"fieldRef": {"apiVersion": "v1", "fieldPath": "metadata.namespace"}}}, {"name": "PATRONI_KUBERNETES_LABELS", "value": "{\"cluster-name\": \"postgresql\", \"app.kubernetes.io/name\": \"patroni\"}"}, {"name": "PATRONI_SUPERUSER_USERNAME", "valueFrom": {"secretKeyRef": {"key": "superuser-username", "name": "postgresql"}}}, {"name": "PATRONI_SUPERUSER_PASSWORD", "valueFrom": {"secretKeyRef": {"key": "superuser-password", "name": "postgresql"}}}, {"name": "PATRONI_REPLICATION_USERNAME", "valueFrom": {"secretKeyRef": {"key": "replication-username", "name": "postgresql"}}}, {"name": "PATRONI_REPLICATION_PASSWORD", "valueFrom": {"secretKeyRef": {"key": "replication-password", "name": "postgresql"}}}, {"name": "APP_USER", "valueFrom": {"secretKeyRef": {"key": "app-db-username", "name": "postgresql"}}}, {"name": "APP_PASSWORD", "valueFrom": {"secretKeyRef": {"key": "app-db-password", "name": "postgresql"}}}, {"name": "APP_DATABASE", "valueFrom": {"secretKeyRef": {"key": "app-db-name", "name": "postgresql"}}}, {"name": "PATRONI_SCOPE", "value": "postgresql"}, {"name": "PATRONI_NAME", "valueFrom": {"fieldRef": {"apiVersion": "v1", "fieldPath": "metadata.name"}}}, {"name": "PATRONI_LOG_LEVEL", "value": "WARNING"}, {"name": "PATRONI_POSTGRESQL_DATA_DIR", "value": "/home/postgres/pgdata/pgroot/data"}, {"name": "PATRONI_POSTGRESQL_PGPASS", "value": "/tmp/pgpass"}, {"name": "PATRONI_POSTGRESQL_LISTEN", "value": "0.0.0.0:5432"}, {"name": "PATRONI_RESTAPI_LISTEN", "value": "0.0.0.0:8008"}, {"name": "POSTGRESQL_SYNCHRONOUS_MODE", "value": "on"}], "image": "docker-registry.default.svc:5000/bcgov/patroni:v10-stable", "imagePullPolicy": "Always", "name": "postgresql", "ports": [{"containerPort": 8008, "protocol": "TCP"}, {"containerPort": 5432, "protocol": "TCP"}], "readinessProbe": {"exec": {"command": ["/usr/share/scripts/patroni/health_check.sh"]}, "failureThreshold": 4, "initialDelaySeconds": 5, "timeoutSeconds": 5}, "resources": {"limits": {"cpu": "500m", "memory": "512Mi"}, "requests": {"cpu": "100m", "memory": "512Mi"}}, "terminationMessagePath": "/dev/termination-log", "terminationMessagePolicy": "File", "volumeMounts": [{"mountPath": "/home/postgres/pgdata", "name": "postgresql"}]}], "dnsPolicy": "ClusterFirst", "restartPolicy": "Always", "schedulerName": "default-scheduler", "securityContext": {}, "serviceAccountName": "postgresql", "terminationGracePeriodSeconds": 0}}, "updateStrategy": {"type": "RollingUpdate"}, "volumeClaimTemplates": [{"metadata": {"annotations": null, "labels": {"app": "postgresql"}, "name": "postgresql"}, "spec": {"accessModes": ["ReadWriteOnce"], "resources": {"requests": {"storage": "5Gi"}}}}]}}, {"apiVersion": "v1", "kind": "ServiceAccount", "metadata": {"labels": {"app": "postgresql", "app.kubernetes.io/component": "database", "app.kubernetes.io/instance": "postgresql", "app.kubernetes.io/managed-by": "template", "app.kubernetes.io/name": "patroni", "app.kubernetes.io/version": "10", "cluster-name": "postgresql", "phase": "deploy"}, "name": "postgresql"}}, {"apiVersion": "rbac.authorization.k8s.io/v1", "kind": "Role", "metadata": {"labels": {"app": "postgresql", "app.kubernetes.io/component": "database", "app.kubernetes.io/instance": "postgresql", "app.kubernetes.io/managed-by": "template", "app.kubernetes.io/name": "patroni", "app.kubernetes.io/version": "10", "cluster-name": "postgresql", "phase": "deploy"}, "name": "postgresql"}, "rules": [{"apiGroups": [""], "resources": ["services"], "verbs": ["create", "get", "list", "patch", "update", "watch", "delete"]}, {"apiGroups": [""], "resources": ["configmaps"], "verbs": ["create", "get", "list", "patch", "update", "watch", "delete"]}, {"apiGroups": [""], "resources": ["endpoints"], "verbs": ["get", "patch", "update", "create", "list", "watch", "delete"]}, {"apiGroups": [""], "resources": ["pods"], "verbs": ["get", "list", "patch", "update", "watch"]}]}, {"apiVersion": "rbac.authorization.k8s.io/v1", "kind": "RoleBinding", "metadata": {"labels": {"app": "postgresql", "app.kubernetes.io/component": "database", "app.kubernetes.io/instance": "postgresql", "app.kubernetes.io/managed-by": "template", "app.kubernetes.io/name": "patroni", "app.kubernetes.io/version": "10", "cluster-name": "postgresql", "phase": "deploy"}, "name": "postgresql"}, "roleRef": {"apiGroup": "rbac.authorization.k8s.io", "kind": "Role", "name": "postgresql"}, "subjects": [{"kind": "ServiceAccount", "name": "postgresql"}]}]}